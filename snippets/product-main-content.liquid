{%- liquid
  assign desktop_media_position = settings.desktop_media_position | default: 'left'
  assign swap_columns_mobile = settings.swap_columns_mobile | default: false
  assign padding_top_desktop = settings.padding_top_desktop | default: 60
  assign padding_bottom_desktop = settings.padding_bottom_desktop | default: 60
  assign padding_horizontal_desktop = settings.padding_horizontal_desktop | default: 20
  assign margin_top_desktop = settings.margin_top_desktop | default: 0
  assign margin_bottom_desktop = settings.margin_bottom_desktop | default: 0
  assign padding_top_mobile = settings.padding_top_mobile | default: 40
  assign padding_bottom_mobile = settings.padding_bottom_mobile | default: 40
  assign padding_horizontal_mobile = settings.padding_horizontal_mobile | default: 20
  assign margin_top_mobile = settings.margin_top_mobile | default: 0
  assign margin_bottom_mobile = settings.margin_bottom_mobile | default: 0
  assign section_height_desktop = settings.section_height_desktop | default: 2000
  assign section_height_mobile = settings.section_height_mobile | default: 2000
-%}

<div class="product-main-section" style="padding-top: {{ padding_top_desktop }}px; padding-bottom: {{ padding_bottom_desktop }}px; padding-left: {{ padding_horizontal_desktop }}px; padding-right: {{ padding_horizontal_desktop }}px; margin-top: {{ margin_top_desktop }}px; margin-bottom: {{ margin_bottom_desktop }}px;">
  <div class="container">
    <div class="row g-5 align-items-start {% if swap_columns_mobile %}flex-column-reverse flex-lg-row{% endif %}">
      <!-- Product Images Column -->
      <div class="col-lg-6 {% if desktop_media_position == 'right' %}order-lg-2{% endif %}">
        {% for block in section.blocks %}
          {% if block.type == 'product-media-gallery' %}
            {% render 'product-media-gallery', block: block %}
          {% endif %}
        {% endfor %}
      </div>

      <!-- Product Info Column -->
      <div class="col-lg-6 {% if desktop_media_position == 'right' %}order-lg-1{% endif %}">
        {% for block in section.blocks %}
          {% if block.type == 'product-media-gallery' %}
            {%- comment -%} Skip - already rendered in left column {%- endcomment -%}
          {% elsif block.type == 'product-details' %}
            {% render 'product-details', block: block, section: section %}
          {% elsif block.type == 'text' or block.type == 'richtext' or block.type == 'html' or block.type == 'liquid' or block.type == '@app' %}
            {%- comment -%} These blocks are handled inside product-details.liquid after the form {%- endcomment -%}
            {%- comment -%} But we need to check if product-details block exists first {%- endcomment -%}
            {%- liquid
              assign has_product_details = false
              for section_block in section.blocks
                if section_block.type == 'product-details'
                  assign has_product_details = true
                  break
                endif
              endfor
            -%}
            {% unless has_product_details %}
              {%- comment -%} If no product-details block, render these blocks directly {%- endcomment -%}
              <div class="product-details-block mb-4" {{ block.shopify_attributes }}>
                {% case block.type %}
                  {% when 'text' %}
                    <div class="product-details-text">
                      {{ block.settings.text }}
                    </div>
                  {% when 'richtext' %}
                    <div class="product-details-richtext">
                      {{ block.settings.richtext }}
                    </div>
                  {% when 'html' %}
                    <div class="product-details-html">
                      {{ block.settings.html }}
                    </div>
                  {% when 'liquid' %}
                    <div class="product-details-liquid">
                      {{ block.settings.liquid }}
                    </div>
                  {% when '@app' %}
                    <div class="product-details-app-embed" data-product-id="{{ product.id }}" data-variant-id="{{ product.selected_or_first_available_variant.id }}">
                      {% render block %}
                    </div>
                {% endcase %}
              </div>
            {% endunless %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<style>
  @media (max-width: 991px) {
    .product-main-section {
      padding-top: {{ padding_top_mobile }}px !important;
      padding-bottom: {{ padding_bottom_mobile }}px !important;
      padding-left: {{ padding_horizontal_mobile }}px !important;
      padding-right: {{ padding_horizontal_mobile }}px !important;
      margin-top: {{ margin_top_mobile }}px !important;
      margin-bottom: {{ margin_bottom_mobile }}px !important;
      min-height: {{ section_height_mobile }}px !important;
    }
  }
  
  /* Desktop: Section Height and Spacing */
  @media (min-width: 992px) {
    .product-main-section {
      min-height: {{ section_height_desktop }}px !important;
    }
  }
</style>

