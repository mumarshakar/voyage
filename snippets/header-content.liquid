{%- liquid
  assign header_settings = section.settings

  if header_settings == blank
    assign logo_text = shop.name
    assign logo_line1 = 'GLOW'
    assign logo_line2 = 'DECK'
    assign two_line_logo = false
    assign logo_image = blank
    assign logo_width = 200
    assign logo_max_height = 60
    assign logo_font_size = 24
    assign logo_color = '#8B6F47'
    assign menu = 'main-menu'
    assign menu_alignment = 'right'
    assign menu_font_size = 16
    assign menu_font_weight = '500'
    assign menu_link_spacing = 8
    assign menu_link_color = '#8B6F47'
    assign menu_link_hover_color = '#8B6F47'
    assign dropdown_bg_color = '#FFFFFF'
    assign dropdown_link_color = '#333333'
    assign dropdown_hover_bg_color = '#FFF8E7'
    assign dropdown_hover_color = '#FF6B35'
    assign header_bg_color = '#FFFFFF'
    assign header_shadow = true
    assign header_style = 'fixed'
    assign fixed_position = 'top'
    assign position_top = 0
    assign position_bottom = 0
    assign position_left = 0
    assign position_right = 0
    assign header_z_index = 1000
    assign make_header_transparent = false
    assign transparent_on_homepage = false
    assign header_padding_top = 16
    assign header_padding_bottom = 16
    assign header_margin_top = 0
    assign header_margin_bottom = 0
    assign show_search = true
    assign show_cart = true
    assign icon_size = 20
    assign show_mobile_menu = true
    assign mobile_menu_icon_color = '#333333'
    assign mobile_menu_icon_size = 24
    assign mobile_menu_border_color = '#333333'
    assign mobile_menu_border_width = 1
    assign mobile_menu_border_radius = 4
    assign mobile_menu_bg_transparent = true
    assign mobile_menu_bg_color = '#FFFFFF'
    assign mobile_menu_padding = 8
    assign mobile_menu_stroke_width = 2
    assign scrolled_bg_color = '#FFFFFF'
    assign scrolled_padding_top = 12
    assign scrolled_padding_bottom = 12
    assign scrolled_shadow = true
    assign scroll_threshold = 50
  else
    assign logo_text = header_settings.logo_text | default: shop.name
    assign logo_line1 = header_settings.logo_line1 | default: 'GLOW'
    assign logo_line2 = header_settings.logo_line2 | default: 'DECK'
    assign two_line_logo_setting = header_settings.two_line_logo
    if two_line_logo_setting == true
      assign two_line_logo = true
    else
      assign two_line_logo = false
    endif
    assign logo_image = header_settings.logo_image
    assign logo_width = header_settings.logo_width | default: 200
    assign logo_max_height = header_settings.logo_max_height | default: 60
    assign logo_font_size = header_settings.logo_font_size | default: 24
    assign logo_color = header_settings.logo_color | default: '#8B6F47'
    assign menu = header_settings.menu | default: 'main-menu'
    assign menu_alignment = header_settings.menu_alignment | default: 'right'
    assign menu_font_size = header_settings.menu_font_size | default: 16
    assign menu_font_weight = header_settings.menu_font_weight | default: '500'
    assign menu_link_spacing = header_settings.menu_link_spacing | default: 8
    assign menu_link_color = header_settings.menu_link_color | default: '#8B6F47'
    assign menu_link_hover_color = header_settings.menu_link_hover_color | default: '#8B6F47'
    assign dropdown_bg_color = header_settings.dropdown_bg_color | default: '#FFFFFF'
    assign dropdown_link_color = header_settings.dropdown_link_color | default: '#333333'
    assign dropdown_hover_bg_color = header_settings.dropdown_hover_bg_color | default: '#FFF8E7'
    assign dropdown_hover_color = header_settings.dropdown_hover_color | default: '#FF6B35'
    assign header_bg_color = header_settings.header_bg_color | default: '#FFFFFF'

    assign header_shadow_setting = header_settings.header_shadow
    if header_shadow_setting == false
      assign header_shadow = false
    elsif header_shadow_setting == true
      assign header_shadow = true
    else
      assign header_shadow = true
    endif

    assign header_style = header_settings.header_style | default: 'fixed'
    assign fixed_position = header_settings.fixed_position | default: 'top'
    assign position_top = header_settings.position_top | default: 0
    assign position_bottom = header_settings.position_bottom | default: 0
    assign position_left = header_settings.position_left | default: 0
    assign position_right = header_settings.position_right | default: 0
    assign header_z_index = header_settings.header_z_index | default: 1000

    assign make_header_transparent_setting = header_settings.make_header_transparent
    if make_header_transparent_setting == true
      assign make_header_transparent = true
    elsif make_header_transparent_setting == false
      assign make_header_transparent = false
    else
      assign make_header_transparent = false
    endif

    assign transparent_on_homepage_setting = header_settings.transparent_on_homepage
    if transparent_on_homepage_setting == true
      assign transparent_on_homepage = true
    elsif transparent_on_homepage_setting == false
      assign transparent_on_homepage = false
    else
      assign transparent_on_homepage = false
    endif

    assign header_padding_top = header_settings.header_padding_top | default: 16
    assign header_padding_bottom = header_settings.header_padding_bottom | default: 16
    assign header_margin_top = header_settings.header_margin_top | default: 0
    assign header_margin_bottom = header_settings.header_margin_bottom | default: 0

    # Handle checkbox settings explicitly
    assign show_search_setting = header_settings.show_search
    if show_search_setting == false
      assign show_search = false
    elsif show_search_setting == true
      assign show_search = true
    else
      assign show_search = true
    endif

    assign show_cart_setting = header_settings.show_cart
    if show_cart_setting == false
      assign show_cart = false
    elsif show_cart_setting == true
      assign show_cart = true
    else
      assign show_cart = true
    endif

    assign icon_size = header_settings.icon_size | default: 20

    assign show_mobile_menu_setting = header_settings.show_mobile_menu
    if show_mobile_menu_setting == false
      assign show_mobile_menu = false
    elsif show_mobile_menu_setting == true
      assign show_mobile_menu = true
    else
      assign show_mobile_menu = true
    endif

    assign mobile_menu_icon_color = header_settings.mobile_menu_icon_color | default: '#333333'
    assign mobile_menu_icon_size = header_settings.mobile_menu_icon_size | default: 24
    assign mobile_menu_border_color = header_settings.mobile_menu_border_color | default: '#333333'
    assign mobile_menu_border_width = header_settings.mobile_menu_border_width | default: 1
    assign mobile_menu_border_radius = header_settings.mobile_menu_border_radius | default: 4

    assign mobile_menu_bg_transparent_setting = header_settings.mobile_menu_bg_transparent
    if mobile_menu_bg_transparent_setting == false
      assign mobile_menu_bg_transparent = false
    elsif mobile_menu_bg_transparent_setting == true
      assign mobile_menu_bg_transparent = true
    else
      assign mobile_menu_bg_transparent = true
    endif

    assign mobile_menu_bg_color = header_settings.mobile_menu_bg_color | default: '#FFFFFF'
    assign mobile_menu_padding = header_settings.mobile_menu_padding | default: 8
    assign mobile_menu_stroke_width = header_settings.mobile_menu_stroke_width | default: 2

    assign scrolled_bg_color = header_settings.scrolled_bg_color | default: header_bg_color
    assign scrolled_padding_top = header_settings.scrolled_padding_top | default: 12
    assign scrolled_padding_bottom = header_settings.scrolled_padding_bottom | default: 12

    assign scrolled_shadow_setting = header_settings.scrolled_shadow
    if scrolled_shadow_setting == false
      assign scrolled_shadow = false
    elsif scrolled_shadow_setting == true
      assign scrolled_shadow = true
    else
      assign scrolled_shadow = true
    endif

    assign scroll_threshold = header_settings.scroll_threshold | default: 50
  endif
-%}

<nav class="navbar navbar-expand-lg {% if header_style == 'sticky' %}navbar-sticky{% elsif header_style == 'fixed' %}{% if fixed_position == 'bottom' %}fixed-bottom{% else %}fixed-top{% endif %}{% elsif header_style == 'absolute' %}navbar-absolute{% endif %} {% if header_style == 'sticky' or header_style == 'fixed' %}navbar-scrollable{% endif %} {% if make_header_transparent or transparent_on_homepage and template.name == 'index' %}navbar-transparent{% endif %}" 
     style="background-color: {% if header_style == 'sticky' or header_style == 'fixed' %}transparent{% elsif make_header_transparent %}transparent{% elsif transparent_on_homepage and template.name == 'index' %}transparent{% else %}{{ header_bg_color }}{% endif %}; 
            padding-top: {{ header_padding_top }}px; 
            padding-bottom: {{ header_padding_bottom }}px;
            margin-top: {{ header_margin_top }}px;
            margin-bottom: {{ header_margin_bottom }}px;
            z-index: {{ header_z_index }};
            {% if header_style == 'absolute' or header_style == 'fixed' %}
            {% if position_top > 0 %}top: {{ position_top }}px;{% endif %}
            {% if position_bottom > 0 %}bottom: {{ position_bottom }}px;{% endif %}
            {% if position_left > 0 %}left: {{ position_left }}px;{% endif %}
            {% if position_right > 0 %}right: {{ position_right }}px;{% endif %}
            {% endif %}
            {% if header_shadow %}{% if make_header_transparent or transparent_on_homepage and template.name == 'index' %}box-shadow: none;{% else %}box-shadow: 0 2px 10px rgba(0,0,0,0.1);{% endif %}{% else %}box-shadow: none;{% endif %}">
  <div class="container">
    <a class="navbar-brand" href="{{ routes.root_url }}" style="font-size: {{ logo_font_size }}px; color: {{ logo_color }} !important;">
      {% if logo_image != blank %}
          <img src="{{ logo_image | image_url: width: logo_width }}" 
               alt="{{ logo_text }}"
               class="logo-image"
               width="{{ logo_width }}"
               height="{{ logo_max_height }}"
               style="max-height: {{ logo_max_height }}px; width: auto;">
      {% elsif two_line_logo %}
        <div class="logo-two-line">
          <span class="logo-line1">{{ logo_line1 }}</span>
          <span class="logo-line2">{{ logo_line2 }}</span>
        </div>
      {% else %}
        {{ logo_text }}
      {% endif %}
    </a>
    {% if show_mobile_menu %}
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
            style="border-color: {{ mobile_menu_border_color }};
                   border-width: {{ mobile_menu_border_width }}px;
                   border-radius: {{ mobile_menu_border_radius }}px;
                   background-color: {% if mobile_menu_bg_transparent %}transparent{% else %}{{ mobile_menu_bg_color }}{% endif %};
                   padding: {{ mobile_menu_padding }}px;
                   width: {{ mobile_menu_icon_size | plus: mobile_menu_padding | plus: mobile_menu_padding }}px;
                   height: {{ mobile_menu_icon_size | plus: mobile_menu_padding | plus: mobile_menu_padding }}px;">
      {%- liquid
        assign svg_color = mobile_menu_icon_color | url_encode
        assign svg_stroke = mobile_menu_stroke_width
        assign svg_path = 'M4 7h22M4 15h22M4 23h22' | url_encode
        assign svg_base = 'data:image/svg+xml,'
        assign svg_start = '%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 30 30%27%3e'
        assign svg_path_tag = '%3cpath stroke=%27' | append: svg_color | append: '%27 stroke-linecap=%27round%27 stroke-miterlimit=%2710%27 stroke-width=%27' | append: svg_stroke | append: '%27 d=%27' | append: svg_path | append: '%27/%3e'
        assign svg_end = '%3c/svg%3e'
        assign svg_data = svg_base | append: svg_start | append: svg_path_tag | append: svg_end
      -%}
      <span class="navbar-toggler-icon" style="background-image: url('{{ svg_data }}'); width: {{ mobile_menu_icon_size }}px; height: {{ mobile_menu_icon_size }}px; background-size: {{ mobile_menu_icon_size }}px {{ mobile_menu_icon_size }}px;"></span>
    </button>
    {% endif %}
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav {% if menu_alignment == 'left' %}me-auto{% elsif menu_alignment == 'right' %}ms-auto{% else %}mx-auto{% endif %}">
        {% if menu != blank %}
          {% for link in linklists[menu].links %}
            {% if link.links != blank %}
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" 
                   href="{{ link.url }}" 
                   role="button" 
                   data-bs-toggle="dropdown"
                   style="color: {{ menu_link_color }} !important; 
                          font-size: {{ menu_font_size }}px;
                          font-weight: {{ menu_font_weight }};">
                  {{ link.title }}
                </a>
                <ul class="dropdown-menu" style="background-color: {{ dropdown_bg_color }};">
                  {% for childlink in link.links %}
                    <li>
                      <a class="dropdown-item" 
                         href="{{ childlink.url }}"
                         style="color: {{ dropdown_link_color }} !important;">
                        {{ childlink.title }}
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </li>
            {% else %}
              <li class="nav-item">
                <a class="nav-link {% if link.active or request.page_type == 'index' and link.title == 'Home' %}active{% endif %}" 
                   href="{{ link.url }}"
                   style="color: {{ menu_link_color }} !important; 
                          font-size: {{ menu_font_size }}px;
                          font-weight: {{ menu_font_weight }};
                          margin: 0 {{ menu_link_spacing }}px;">
                  {{ link.title }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
        {% endif %}
      </ul>
      
      {% if show_search or show_cart %}
        <div class="header-icons d-flex align-items-center ms-3">
          {% if show_search %}
            <a href="{{ routes.search_url }}" class="header-icon me-3" style="color: {{ menu_link_color }};">
              <i class="bi bi-search" style="font-size: {{ icon_size }}px;"></i>
            </a>
          {% endif %}
          {% if show_cart %}
            <a href="{{ routes.cart_url }}" class="header-icon position-relative" style="color: {{ menu_link_color }};">
              <i class="bi bi-bag" style="font-size: {{ icon_size }}px;"></i>
              {% if cart.item_count > 0 %}
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.7rem;">
                  {{ cart.item_count }}
                </span>
              {% endif %}
            </a>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
</nav>

<style>
  .navbar-sticky {
    position: sticky;
    top: 0;
  }
  
  .navbar.fixed-top {
    position: fixed;
    top: 0;
    width: 100%;
  }
  
  .navbar.fixed-bottom {
    position: fixed;
    bottom: 0;
    width: 100%;
  }
  
  .navbar-absolute {
    position: absolute;
    width: 100%;
  }
  
  {% if header_style == 'fixed' and fixed_position == 'top' %}
  body {
    padding-top: calc({{ position_top }}px + {{ header_margin_top }}px + {{ header_padding_top }}px + {{ header_padding_bottom }}px + 1.5rem);
  }
  {% elsif header_style == 'fixed' and fixed_position == 'bottom' %}
  body {
    padding-bottom: calc({{ position_bottom }}px + {{ header_margin_top }}px + {{ header_padding_top }}px + {{ header_padding_bottom }}px + 1.5rem);
  }
  {% endif %}
  
  .navbar-transparent {
    background-color: transparent !important;
    box-shadow: none !important;
  }
  
  {% if make_header_transparent or transparent_on_homepage and template.name == 'index' %}
  .navbar-transparent .nav-link {
    color: {{ menu_link_color }} !important;
  }
  {% endif %}
  
  .nav-link:hover {
    color: {{ menu_link_hover_color }} !important;
  }
  
  .dropdown-item:hover {
    background-color: {{ dropdown_hover_bg_color }};
    color: {{ dropdown_hover_color }} !important;
  }
  
  .header-icon {
    text-decoration: none;
    transition: color 0.3s;
  }
  
  .header-icon:hover {
    color: {{ menu_link_hover_color }} !important;
  }
  
  /* Initial state for sticky/fixed headers - transparent */
  .navbar-scrollable {
    background-color: transparent !important;
    transition: background-color 0.3s ease, padding 0.3s ease, box-shadow 0.3s ease;
  }
  
  /* Scrolled Header Styles - apply background when scrolled */
  .navbar-scrollable.navbar-scrolled {
    background-color: {% if scrolled_bg_color != blank %}{{ scrolled_bg_color }}{% else %}{{ header_bg_color }}{% endif %} !important;
    padding-top: {{ scrolled_padding_top }}px !important;
    padding-bottom: {{ scrolled_padding_bottom }}px !important;
    {% if scrolled_shadow %}box-shadow: 0 2px 15px rgba(0,0,0,0.15) !important;{% else %}box-shadow: none !important;{% endif %}
  }
  
  /* Ensure scrolled styles override transparent styles */
  .navbar-scrollable.navbar-scrolled.navbar-transparent {
    background-color: {% if scrolled_bg_color != blank %}{{ scrolled_bg_color }}{% else %}{{ header_bg_color }}{% endif %} !important;
  }
</style>

<script>
  (function() {
    const navbar = document.querySelector('.navbar-sticky, .fixed-top, .fixed-bottom');
    if (!navbar) return;
    
    const scrollThreshold = {{ scroll_threshold }};
    const headerStyle = '{{ header_style }}';
    
    // Only apply scroll behavior for sticky or fixed headers
    if (headerStyle !== 'sticky' && headerStyle !== 'fixed') return;
    
    function handleScroll() {
      const scrollY = window.pageYOffset || document.documentElement.scrollTop;
      
      if (scrollY > scrollThreshold) {
        navbar.classList.add('navbar-scrolled');
      } else {
        navbar.classList.remove('navbar-scrolled');
      }
    }
    
    // Check on load
    handleScroll();
    
    // Listen for scroll events (throttled for performance)
    let ticking = false;
    window.addEventListener('scroll', function() {
      if (!ticking) {
        window.requestAnimationFrame(function() {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    });
  })();
</script>

