{% schema %}
{
  "name": "Service Showcase",
  "settings": [
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "select",
      "id": "section_width_type",
      "label": "Section Width",
      "options": [
        {
          "value": "container",
          "label": "Container"
        },
        {
          "value": "full_width",
          "label": "Full Width"
        }
      ],
      "default": "container",
      "info": "Choose between container (max-width) or full-width layout"
    },
    {
      "type": "checkbox",
      "id": "swap_columns",
      "label": "Swap Columns Order",
      "default": false,
      "info": "When enabled, text column appears first, image column appears second"
    },
    {
      "type": "range",
      "id": "column_gap",
      "label": "Gap Between Columns (px)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 40,
      "unit": "px",
      "info": "Horizontal gap between columns on desktop"
    },
    {
      "type": "range",
      "id": "column_gap_mobile",
      "label": "Gap When Stacked on Mobile (px)",
      "min": 0,
      "max": 80,
      "step": 5,
      "default": 30,
      "unit": "px",
      "info": "Vertical gap when columns stack on mobile"
    },
    {
      "type": "checkbox",
      "id": "reverse_columns_mobile",
      "label": "Reverse Column Order on Mobile",
      "default": false,
      "info": "When enabled, text column appears first, image column appears second on mobile devices"
    },
    {
      "type": "select",
      "id": "vertical_alignment",
      "label": "Text Column Vertical Position",
      "options": [
        {
          "value": "top",
          "label": "Top"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "bottom",
          "label": "Bottom"
        }
      ],
      "default": "center",
      "info": "Controls the vertical position of text content within the text column"
    },
    {
      "type": "header",
      "content": "Image Column"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image",
      "info": "Recommended size: 1200x800px or larger"
    },
    {
      "type": "text",
      "id": "image_alt",
      "label": "Image Alt Text",
      "info": "Important for accessibility and SEO"
    },
    {
      "type": "url",
      "id": "image_link",
      "label": "Image Link (Optional)",
      "info": "Make the image clickable by adding a URL"
    },
    {
      "type": "select",
      "id": "image_fit",
      "label": "Image Fit",
      "options": [
        {
          "value": "cover",
          "label": "Cover"
        },
        {
          "value": "contain",
          "label": "Contain"
        }
      ],
      "default": "cover",
      "info": "Cover: fills entire area, Contain: shows full image"
    },
    {
      "type": "range",
      "id": "image_height",
      "label": "Image Column Height (px)",
      "min": 300,
      "max": 1000,
      "step": 50,
      "default": 500,
      "unit": "px",
      "info": "Minimum height for the image column"
    },
    {
      "type": "color",
      "id": "image_column_bg_color",
      "label": "Image Column Background Color",
      "info": "Background color for the image column (visible if image doesn't fill the area)"
    },
    {
      "type": "header",
      "content": "Text Column"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Service Title"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "info": "Optional subheading text"
    },
    {
      "type": "select",
      "id": "content_source",
      "label": "Content Source",
      "options": [
        {
          "value": "manual",
          "label": "Manual Text"
        },
        {
          "value": "product",
          "label": "Product Description"
        }
      ],
      "default": "manual",
      "info": "Choose to write text manually or use a product's description"
    },
    {
      "type": "product",
      "id": "selected_product",
      "label": "Select Product",
      "info": "Product whose description will be displayed (only used when Content Source is 'Product Description')"
    },
    {
      "type": "richtext",
      "id": "text_content",
      "label": "Text Content",
      "default": "<p>Add your service description here. You can format text, add links, and create lists using the rich text editor.</p>",
      "info": "Supports rich text formatting, links, lists, and more (only used when Content Source is 'Manual Text')"
    },
    {
      "type": "text",
      "id": "buy_now_button_text",
      "label": "Buy Now Button Text",
      "default": "Buy Now",
      "info": "Text for the Buy Now button"
    },
    {
      "type": "url",
      "id": "buy_now_button_link",
      "label": "Buy Now Button Link",
      "info": "Link for the Buy Now button (e.g., product URL or checkout URL)"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "text_padding",
      "label": "Text Column Padding (px)",
      "min": 20,
      "max": 100,
      "step": 5,
      "default": 40,
      "unit": "px",
      "info": "Internal padding for the text column"
    },
    {
      "type": "color",
      "id": "text_column_bg_color",
      "label": "Text Column Background Color",
      "info": "Background color for the text column"
    },
    {
      "type": "header",
      "content": "Typography Settings"
    },
    {
      "type": "paragraph",
      "content": "Typography is controlled by Theme Settings. Go to Theme Settings > Typography to customize fonts, sizes, and colors globally."
    },
    {
      "type": "color",
      "id": "heading_color_override",
      "label": "Heading Color Override (Optional)",
      "info": "Leave empty to use theme default heading color. Set a color here to override for this section only.",
      "default": ""
    },
    {
      "type": "color",
      "id": "text_color_override",
      "label": "Text Color Override (Optional)",
      "info": "Leave empty to use theme default body text color. Set a color here to override for this section only.",
      "default": ""
    },
    {
      "type": "header",
      "content": "Section Styling"
    },
    {
      "type": "color",
      "id": "section_bg_color",
      "label": "Section Background Color",
      "default": "#FFFFFF"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Section Top Padding (px)",
      "min": 0,
      "max": 200,
      "step": 10,
      "default": 80,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Section Bottom Padding (px)",
      "min": 0,
      "max": 200,
      "step": 10,
      "default": 80,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_horizontal",
      "label": "Section Horizontal Padding (px)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Mobile Settings"
    },
    {
      "type": "range",
      "id": "text_padding_mobile_top",
      "label": "Text Column Padding Top - Mobile (px)",
      "min": 10,
      "max": 80,
      "step": 5,
      "default": 30,
      "unit": "px",
      "info": "Top padding for text column on mobile devices"
    },
    {
      "type": "range",
      "id": "text_padding_mobile_bottom",
      "label": "Text Column Padding Bottom - Mobile (px)",
      "min": 10,
      "max": 80,
      "step": 5,
      "default": 30,
      "unit": "px",
      "info": "Bottom padding for text column on mobile devices"
    },
    {
      "type": "range",
      "id": "text_padding_mobile_left",
      "label": "Text Column Padding Left - Mobile (px)",
      "min": 10,
      "max": 80,
      "step": 5,
      "default": 20,
      "unit": "px",
      "info": "Left padding for text column on mobile devices"
    },
    {
      "type": "range",
      "id": "text_padding_mobile_right",
      "label": "Text Column Padding Right - Mobile (px)",
      "min": 10,
      "max": 80,
      "step": 5,
      "default": 20,
      "unit": "px",
      "info": "Right padding for text column on mobile devices"
    }
  ],
  "presets": [
    {
      "name": "Service Showcase"
    }
  ]
}
{% endschema %}

{%- liquid
  assign section_width_type = section.settings.section_width_type | default: 'container'
  assign swap_columns = section.settings.swap_columns | default: false
  assign column_gap = section.settings.column_gap | default: 40
  assign column_gap_mobile = section.settings.column_gap_mobile | default: 30
  assign vertical_alignment = section.settings.vertical_alignment | default: 'center'
  
  assign image = section.settings.image
  assign image_alt = section.settings.image_alt | default: 'Service image'
  assign image_link = section.settings.image_link
  assign image_fit = section.settings.image_fit | default: 'cover'
  assign image_height = section.settings.image_height | default: 500
  assign image_column_bg_color = section.settings.image_column_bg_color
  
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading
  assign content_source = section.settings.content_source | default: 'manual'
  assign selected_product = section.settings.selected_product
  assign text_content = section.settings.text_content
  assign buy_now_button_text = section.settings.buy_now_button_text | default: 'Buy Now'
  assign buy_now_button_link = section.settings.buy_now_button_link
  
  # Determine content source type (used for conditional rendering)
  assign is_product_source = false
  if content_source == 'product' and selected_product != blank
    assign is_product_source = true
  endif
  assign text_alignment = section.settings.text_alignment | default: 'left'
  assign text_padding = section.settings.text_padding | default: 40
  assign text_column_bg_color = section.settings.text_column_bg_color
  
  # Typography now comes from theme settings (removed section-level typography settings)
  assign heading_color = section.settings.heading_color_override | default: settings.heading_color | default: '#333333'
  assign text_color = section.settings.text_color_override | default: settings.body_text_color | default: '#333333'
  
  assign section_bg_color = section.settings.section_bg_color | default: '#FFFFFF'
  assign padding_top = section.settings.padding_top | default: 80
  assign padding_bottom = section.settings.padding_bottom | default: 80
  assign padding_horizontal = section.settings.padding_horizontal | default: 20
  
  assign reverse_columns_mobile = section.settings.reverse_columns_mobile | default: false
  assign text_padding_mobile_top = section.settings.text_padding_mobile_top | default: 30
  assign text_padding_mobile_bottom = section.settings.text_padding_mobile_bottom | default: 30
  assign text_padding_mobile_left = section.settings.text_padding_mobile_left | default: 20
  assign text_padding_mobile_right = section.settings.text_padding_mobile_right | default: 20
  
  # Determine container class
  if section_width_type == 'full_width'
    assign container_class = 'container-fluid'
  else
    assign container_class = 'container'
  endif
-%}

<section class="service-showcase-section" 
         id="service-showcase-{{ section.id }}"
         style="background-color: {{ section_bg_color }};
                padding-top: {{ padding_top }}px;
                padding-bottom: {{ padding_bottom }}px;
                padding-left: {{ padding_horizontal }}px;
                padding-right: {{ padding_horizontal }}px;">
  
  <div class="{{ container_class }}">
      <div class="service-showcase-wrapper"
           style="gap: {{ column_gap }}px;"
           data-swap="{{ swap_columns }}"
           data-vertical-align="{{ vertical_alignment }}">
        
        {% comment %} Image Column {% endcomment %}
        <div class="service-showcase-image-col"
             style="order: {% if swap_columns %}2{% else %}1{% endif %};
                    {% if image_column_bg_color != blank %}background-color: {{ image_column_bg_color }};{% endif %}">
          {% if image != blank %}
            {% if image_link != blank %}
              <a href="{{ image_link }}" class="service-showcase-image-link" aria-label="{{ image_alt }}">
            {% endif %}
            <div class="service-showcase-image-wrapper"
                 style="min-height: {{ image_height }}px;
                        flex: 1;">
              <img 
                src="{{ image | image_url: width: 1200 }}"
                srcset="{{ image | image_url: width: 400 }} 400w,
                        {{ image | image_url: width: 800 }} 800w,
                        {{ image | image_url: width: 1200 }} 1200w,
                        {{ image | image_url: width: 1600 }} 1600w"
                sizes="(max-width: 767px) 100vw, 50vw"
                alt="{{ image_alt | escape }}"
                width="{{ image.width }}"
                height="{{ image.height }}"
                class="service-showcase-image"
                style="object-fit: {{ image_fit }};
                       width: 100%;
                       height: 100%;
                       display: block;"
                loading="lazy">
            </div>
            {% if image_link != blank %}
              </a>
            {% endif %}
          {% else %}
            <div class="service-showcase-image-placeholder"
                 style="min-height: {{ image_height }}px;
                        background-color: #f0f0f0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: #999;">
              <p>Please upload an image</p>
            </div>
          {% endif %}
        </div>
        
        {% comment %} Text Column {% endcomment %}
        <div class="service-showcase-text-col"
             style="order: {% if swap_columns %}1{% else %}2{% endif %};
                    text-align: {{ text_alignment }};
                    padding: {{ text_padding }}px;
                    justify-content: {% case vertical_alignment %}{% when 'top' %}flex-start{% when 'center' %}center{% when 'bottom' %}flex-end{% endcase %};
                    {% if text_column_bg_color != blank %}background-color: {{ text_column_bg_color }};{% endif %}">
          {% if heading != blank %}
            <h2 class="service-showcase-heading"
                style="color: {{ heading_color }};
                       margin-top: 0;
                       margin-bottom: 1rem;">
              {{ heading }}
            </h2>
          {% endif %}
          
          {% if subheading != blank %}
            <h3 class="service-showcase-subheading"
                style="color: {{ heading_color }};
                       margin-top: 0;
                       margin-bottom: 1rem;
                       opacity: 0.8;">
              {{ subheading }}
            </h3>
          {% endif %}
          
          {% if is_product_source %}
            {% if selected_product.description != blank %}
              <div class="service-showcase-content"
                   style="color: {{ text_color }};
                          margin-bottom: {% if buy_now_button_text != blank and buy_now_button_link != blank %}1.5rem{% else %}0{% endif %};">
                {{ selected_product.description }}
              </div>
            {% else %}
              <div class="service-showcase-content"
                   style="color: {{ text_color }};
                          margin-bottom: {% if buy_now_button_text != blank and buy_now_button_link != blank %}1.5rem{% else %}0{% endif %};">
                <p>Product description not available.</p>
              </div>
            {% endif %}
          {% elsif text_content != blank %}
            <div class="service-showcase-content"
                 style="color: {{ text_color }};
                        margin-bottom: {% if buy_now_button_text != blank and buy_now_button_link != blank %}1.5rem{% else %}0{% endif %};">
              {{ text_content }}
            </div>
          {% endif %}
          
          {% if buy_now_button_text != blank and buy_now_button_link != blank %}
            <div class="service-showcase-button-wrapper" style="margin-top: 1.5rem;">
              <a href="{{ buy_now_button_link }}" 
                 class="btn btn-primary service-showcase-buy-now-button"
                 style="display: inline-block;
                        padding: 12px 30px;
                        background-color: #28a745;
                        color: #ffffff;
                        text-decoration: none;
                        border-radius: 2px;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        border: none;
                        text-align: center;
                        width: 100%;">
                {{ buy_now_button_text }}
              </a>
            </div>
          {% endif %}
        </div>
        
      </div>
    </div>
</section>

<style>
  .service-showcase-section {
    position: relative;
    width: 100%;
  }
  
  .service-showcase-wrapper {
    display: flex;
    align-items: stretch;
    flex-wrap: nowrap;
    width: 100%;
  }
  
  .service-showcase-image-col,
  .service-showcase-text-col {
    flex: 0 0 calc(50% - {{ column_gap | divided_by: 2.0 }}px);
    max-width: calc(50% - {{ column_gap | divided_by: 2.0 }}px);
    position: relative;
    display: flex;
    flex-direction: column;
  }
  
  .service-showcase-image-wrapper {
    width: 100%;
    flex: 1 1 auto;
    position: relative;
    overflow: hidden;
    border-radius: 2px;
    display: flex;
    align-items: stretch;
  }
  
  .service-showcase-image-link {
    display: flex;
    width: 100%;
    height: 100%;
    flex: 1;
    text-decoration: none;
    transition: opacity 0.3s ease;
  }
  
  .service-showcase-image-link:hover {
    opacity: 0.95;
  }
  
  .service-showcase-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.3s ease;
  }
  
  .service-showcase-image-link:hover .service-showcase-image {
    transform: scale(1.02);
  }
  
  .service-showcase-image-placeholder {
    border-radius: 2px;
    border: 2px dashed #ddd;
  }
  
  .service-showcase-text-col {
    display: flex;
    flex-direction: column;
    align-self: stretch;
    flex: 1;
  }
  
  .service-showcase-heading {
    word-wrap: break-word;
  }
  
  .service-showcase-subheading {
    word-wrap: break-word;
  }
  
  .service-showcase-content {
    word-wrap: break-word;
  }
  
  .service-showcase-content p {
    margin-bottom: 1rem;
  }
  
  .service-showcase-content ul,
  .service-showcase-content ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }
  
  .service-showcase-content li {
    margin-bottom: 0.5rem;
  }
  
  /* Preserve HTML formatting from product descriptions */
  .service-showcase-content h1,
  .service-showcase-content h2,
  .service-showcase-content h3,
  .service-showcase-content h4,
  .service-showcase-content h5,
  .service-showcase-content h6 {
    margin-top: 1.5rem;
    margin-bottom: 1rem;
    font-weight: 600;
    line-height: 1.3;
    color: inherit;
  }
  
  .service-showcase-content h1:first-child,
  .service-showcase-content h2:first-child,
  .service-showcase-content h3:first-child,
  .service-showcase-content h4:first-child,
  .service-showcase-content h5:first-child,
  .service-showcase-content h6:first-child {
    margin-top: 0;
  }
  
  .service-showcase-content strong,
  .service-showcase-content b {
    font-weight: 600;
  }
  
  .service-showcase-content em,
  .service-showcase-content i {
    font-style: italic;
  }
  
  .service-showcase-content img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
    margin: 1rem 0;
    display: block;
  }
  
  .service-showcase-content blockquote {
    margin: 1rem 0;
    padding-left: 1rem;
    border-left: 3px solid #ddd;
    font-style: italic;
    color: #666;
  }
  
  .service-showcase-content code {
    background-color: #f5f5f5;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: monospace;
    font-size: 0.9em;
  }
  
  .service-showcase-content pre {
    background-color: #f5f5f5;
    padding: 1rem;
    border-radius: 4px;
    overflow-x: auto;
    margin: 1rem 0;
  }
  
  .service-showcase-content a {
    color: #ff6b35;
    text-decoration: underline;
    transition: color 0.3s ease;
  }
  
  .service-showcase-content a:hover {
    color: #e55a2b;
  }
  
  .service-showcase-button:hover {
    background-color: #e55a2b !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }
  
  .service-showcase-button:active {
    transform: translateY(0);
  }
  
  .service-showcase-buy-now-button:hover {
    background-color: #218838 !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }
  
  .service-showcase-buy-now-button:active {
    transform: translateY(0);
  }
  
  .service-showcase-button-wrapper {
    width: 100%;
  }
  
  .service-showcase-button-wrapper a {
    width: 100%;
  }
  
  /* Vertical Alignment - Note: align-items: stretch is maintained for equal height columns */
  .service-showcase-wrapper[data-vertical-align="top"] .service-showcase-text-col {
    justify-content: flex-start;
  }
  
  .service-showcase-wrapper[data-vertical-align="center"] .service-showcase-text-col {
    justify-content: center;
  }
  
  .service-showcase-wrapper[data-vertical-align="bottom"] .service-showcase-text-col {
    justify-content: flex-end;
  }
  
  /* Mobile Responsive */
  @media (max-width: 767px) {
    .service-showcase-wrapper {
      flex-direction: column;
      gap: {{ column_gap_mobile }}px !important;
    }
    
    .service-showcase-image-col,
    .service-showcase-text-col {
      width: 100% !important;
      flex: 0 0 100% !important;
      max-width: 100% !important;
      order: initial !important;
    }
    
    {% if reverse_columns_mobile %}
      .service-showcase-image-col {
        order: 2 !important;
      }
      
      .service-showcase-text-col {
        order: 1 !important;
      }
    {% else %}
      .service-showcase-image-col {
        order: 1 !important;
      }
      
      .service-showcase-text-col {
        order: 2 !important;
      }
    {% endif %}
    
    .service-showcase-image-wrapper {
      min-height: 300px !important;
    }
    
    .service-showcase-text-col {
      padding: {{ text_padding_mobile_top }}px {{ text_padding_mobile_right }}px {{ text_padding_mobile_bottom }}px {{ text_padding_mobile_left }}px !important;
    }
    
    #service-showcase-{{ section.id }} .service-showcase-heading {
      font-size: calc(var(--heading-font-size) * 0.8) !important;
    }
    
    #service-showcase-{{ section.id }} .service-showcase-subheading {
      font-size: calc(var(--subheading-font-size) * 0.9) !important;
    }
  }
  
  /* Tablet Responsive */
  @media (min-width: 768px) and (max-width: 991px) {
    .service-showcase-image-col,
    .service-showcase-text-col {
      flex: 0 0 calc(50% - {{ column_gap | divided_by: 2.0 }}px);
      max-width: calc(50% - {{ column_gap | divided_by: 2.0 }}px);
    }
  }
</style>

