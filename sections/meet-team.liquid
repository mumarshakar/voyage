{%- liquid
  assign heading_text = section.settings.heading
  assign card_height = section.settings.card_height | default: 360
  assign card_border_radius = section.settings.card_border_radius | default: 2
  assign image_border_radius = section.settings.image_border_radius | default: 2
  assign desktop_columns = section.settings.desktop_cards_per_row | default: '4'
  assign tablet_columns = section.settings.tablet_cards_per_row | default: '3'
  assign mobile_columns = section.settings.mobile_cards_per_row | default: '2'
  assign desktop_columns_int = desktop_columns | plus: 0
  assign tablet_columns_int = tablet_columns | plus: 0
  assign mobile_columns_int = mobile_columns | plus: 0
  assign desktop_visible = section.settings.desktop_cards_visible | default: '4'
  assign tablet_visible = section.settings.tablet_cards_visible | default: '3'
  assign mobile_visible = section.settings.mobile_cards_visible | default: '2'
  
  # Ensure values are valid integers, with safe defaults
  if desktop_visible == blank or desktop_visible == 0
    assign desktop_visible_int = 4
  else
    assign desktop_visible_int = desktop_visible | plus: 0
    if desktop_visible_int < 1
      assign desktop_visible_int = 4
    endif
  endif
  
  if tablet_visible == blank or tablet_visible == 0
    assign tablet_visible_int = 3
  else
    assign tablet_visible_int = tablet_visible | plus: 0
    if tablet_visible_int < 1
      assign tablet_visible_int = 3
    endif
  endif
  
  if mobile_visible == blank or mobile_visible == 0
    assign mobile_visible_int = 2
  else
    assign mobile_visible_int = mobile_visible | plus: 0
    if mobile_visible_int < 1
      assign mobile_visible_int = 2
    endif
  endif
  
  # Ensure column values are valid
  if desktop_columns_int < 1
    assign desktop_columns_int = 4
  endif
  if tablet_columns_int < 1
    assign tablet_columns_int = 3
  endif
  if mobile_columns_int < 1
    assign mobile_columns_int = 2
  endif
  
  # Calculate hide-start index (items beyond this will be hidden)
  assign desktop_hide_start = desktop_visible_int | plus: 1
  assign tablet_hide_start = tablet_visible_int | plus: 1
  assign mobile_hide_start = mobile_visible_int | plus: 1
  # Typography comes from theme settings via theme.liquid - no section-specific values
-%}

<style>
.flip-card {
    background: transparent;
    width: 100%;
    height: var(--team-card-height, 340px);
    perspective: 1000px;
}

.flip-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.6s;
    transform-style: preserve-3d;
}

.flip-card:hover .flip-card-inner {
    transform: rotateY(180deg);
}

.flip-card-front, 
.flip-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: var(--team-card-radius, 2px);
    background: #ffffff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}

.flip-card-front img {
    display: block;
    width: 100%;
    height: calc(var(--team-card-height, 340px) * 0.8);
    object-fit: cover;
    border-radius: var(--team-image-radius, 2px);
}

/* Typography for h5 and p tags comes from theme settings via theme.liquid */

.flip-card-back {
    transform: rotateY(180deg);
    background: #f8f9fa;
    padding: 20px;
}

/* Override Bootstrap container max-width for this section */
#shopify-section-{{ section.id }} .container {
    max-width: 1600px !important;
    width: 100%;
    padding-left: 24px;
    padding-right: 24px;
    margin-left: auto;
    margin-right: auto;
}

.team-grid {
    display: grid !important;
    gap: 24px !important;
    width: 100% !important;
}

.team-item-wrapper {
    width: 100%;
    height: 100%;
}

.team-grid-item {
    min-width: 0;
    max-width: 100%;
}

/* Mobile: 2 cards per row - default/base for all screens */
#shopify-section-{{ section.id }} .team-grid {
    grid-template-columns: repeat({{ mobile_columns_int }}, 1fr) !important;
}

#shopify-section-{{ section.id }} .team-grid-item .team-item-wrapper {
    display: block !important;
}

#shopify-section-{{ section.id }} .team-grid-item:nth-child(n + {{ mobile_hide_start }}) .team-item-wrapper {
    display: none !important;
}

/* Tablet: 3 cards per row - for screens 601px and above */
@media (min-width: 601px) {
    #shopify-section-{{ section.id }} .team-grid {
        grid-template-columns: repeat({{ tablet_columns_int }}, 1fr) !important;
    }
    
    #shopify-section-{{ section.id }} .team-grid-item .team-item-wrapper {
        display: block !important;
    }
    
    #shopify-section-{{ section.id }} .team-grid-item:nth-child(n + {{ tablet_hide_start }}) .team-item-wrapper {
        display: none !important;
    }
}

/* Desktop: 4 cards per row - for screens 992px and above */
@media (min-width: 992px) {
    #shopify-section-{{ section.id }} .team-grid {
        grid-template-columns: repeat({{ desktop_columns_int }}, 1fr) !important;
    }
    
    #shopify-section-{{ section.id }} .team-grid-item .team-item-wrapper {
        display: block !important;
    }
    
    #shopify-section-{{ section.id }} .team-grid-item:nth-child(n + {{ desktop_hide_start }}) .team-item-wrapper {
        display: none !important;
    }
}
</style>

<div class="container py-5"
     style="--team-card-height: {{ card_height }}px;
            --team-card-radius: {{ card_border_radius }}px;
            --team-image-radius: {{ image_border_radius }}px;">
    <h2 class="text-center mb-5">{{ heading_text }}</h2>
      
    <div class="team-grid" style="display: grid !important; gap: 24px !important;">

        {% for block in section.blocks %}
        <div class="team-grid-item" {{ block.shopify_attributes }}>
            <div class="team-item-wrapper">
            <div class="flip-card">
                <div class="flip-card-inner">

                    <!-- Front -->
                    <div class="flip-card-front text-center">
                        {% if block.settings.image != blank %}
                            <img src="{{ block.settings.image | image_url: width: 600 }}" 
                                 alt="{{ block.settings.name | escape }}"
                                 width="{{ block.settings.image.width }}"
                                 height="{{ block.settings.image.height }}"
                                 loading="lazy">
                        {% else %}
                            {% comment %} theme-check-disable RemoteAsset {% endcomment %}
                            <div style="width: 100%; height: calc(var(--team-card-height, 340px) * 0.8); background-color: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: var(--team-image-radius, 2px);">
                              <span style="color: #999;">No image</span>
                            </div>
                            {% comment %} theme-check-enable RemoteAsset {% endcomment %}
                        {% endif %}

                        <h5 class="mt-3 mb-0">
                            {{ block.settings.name }}
                        </h5>
                        <p class="text-muted">
                            {{ block.settings.role }}
                        </p>
                    </div>

                    <!-- Back -->
                    <div class="flip-card-back d-flex align-items-center">
                        <p>
                            {{ block.settings.description }}
                        </p>
                    </div>

                </div>
            </div>
            </div>
        </div>
        {% endfor %}

    </div>
</div>

<style>
/* Force desktop: 4 columns on large screens */
@media (min-width: 992px) {
    #shopify-section-{{ section.id }} .team-grid {
        grid-template-columns: repeat({{ desktop_columns_int }}, 1fr) !important;
        display: grid !important;
    }
}

/* Force tablet: 3 columns on medium screens */
@media (min-width: 601px) and (max-width: 991px) {
    #shopify-section-{{ section.id }} .team-grid {
        grid-template-columns: repeat({{ tablet_columns_int }}, 1fr) !important;
        display: grid !important;
    }
}

/* Force mobile: 2 columns on small screens */
@media (max-width: 600px) {
    #shopify-section-{{ section.id }} .team-grid {
        grid-template-columns: repeat({{ mobile_columns_int }}, 1fr) !important;
        display: grid !important;
    }
}
</style>

{% schema %}
{
  "name": "Team Flip Cards",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Meet Our Team"
    },
    {
      "type": "range",
      "id": "card_height",
      "label": "Card Height (px)",
      "min": 280,
      "max": 500,
      "step": 10,
      "default": 360
    },
    {
      "type": "select",
      "id": "desktop_cards_per_row",
      "label": "Cards Per Row (Desktop)",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" }
      ],
      "default": "4"
    },
    {
      "type": "select",
      "id": "tablet_cards_per_row",
      "label": "Cards Per Row (Tablet)",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" }
      ],
      "default": "3"
    },
    {
      "type": "select",
      "id": "mobile_cards_per_row",
      "label": "Cards Per Row (Mobile)",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ],
      "default": "2"
    },
    {
      "type": "range",
      "id": "desktop_cards_visible",
      "label": "Cards Visible (Desktop)",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 4,
      "info": "Maximum number of team members shown on screens wider than 1024px."
    },
    {
      "type": "range",
      "id": "tablet_cards_visible",
      "label": "Cards Visible (Tablet)",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 3,
      "info": "Maximum number of team members shown between 601px and 1024px."
    },
    {
      "type": "range",
      "id": "mobile_cards_visible",
      "label": "Cards Visible (Mobile)",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 2,
      "info": "Maximum number of team members shown at 600px and below."
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "label": "Card Border Radius (px)",
      "min": 0,
      "max": 40,
      "step": 2,
      "default": 2
    },
    {
      "type": "range",
      "id": "image_border_radius",
      "label": "Image Border Radius (px)",
      "min": 0,
      "max": 40,
      "step": 2,
      "default": 2
    }
  ],
  "blocks": [
    {
      "type": "team_member",
      "name": "Team Member",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Photo"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Name",
          "default": "John Doe"
        },
        {
          "type": "text",
          "id": "role",
          "label": "Role",
          "default": "Senior Developer"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "Team member bio goes here."
        }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "Team Flip Cards",
      "category": "Team"
    }
  ]
}
{% endschema %}